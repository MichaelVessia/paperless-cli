pre-commit:
  commands:
    beads-sync:
      run: |
        if command -v bd >/dev/null 2>&1 && [ -d .beads ]; then
          bd sync --flush-only >/dev/null 2>&1 || echo "Warning: bd sync failed"
          git add .beads/issues.jsonl 2>/dev/null || true
        fi
      priority: 1
    format-fix:
      glob: "*.{ts,tsx,mjs,js,jsx}"
      run: nix develop -c bunx oxfmt {staged_files}
      stage_fixed: true
      priority: 2
    lint-fix:
      glob: "*.{ts,tsx,mjs,js,jsx}"
      run: nix develop -c bunx oxlint --fix {staged_files}
      stage_fixed: true
      priority: 3
    typecheck:
      run: nix develop -c bun run typecheck
      priority: 4
    test:
      run: nix develop -c bun run test
      priority: 4

post-merge:
  commands:
    beads-prime:
      run: |
        if command -v bd >/dev/null 2>&1 && [ -d .beads ]; then
          bd prime >/dev/null 2>&1 || true
        fi
    install-deps:
      run: nix develop -c bun install
